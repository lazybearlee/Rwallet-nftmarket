<!DOCTYPE html><html><head>
      <title>Rholang学习</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="rholang">Rholang </h1>
<p><img src="https://rholang.github.io/assets/static/cheat-sheet.cbab2cf.2442127b2773a251ac152103d83b4dc8.png" alt="CHEATSHEET"></p>

<div class="md-toc">
<details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#rholang" class="md-toc-link"><p>Rholang</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#sending" class="md-toc-link"><p>Sending</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#say-hello" class="md-toc-link">
            <p>Say hello</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#stdout" class="md-toc-link">
            <p>Stdout</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#concurency" class="md-toc-link">
            <p>Concurency</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#receiving" class="md-toc-link"><p>Receiving</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#check-for-messages" class="md-toc-link">
            <p>Check for messages</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#comm-events" class="md-toc-link"><p>Comm Events</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#receiving-before-sending" class="md-toc-link">
            <p>Receiving Before Sending</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#contracts" class="md-toc-link"><p>Contracts</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#persistent" class="md-toc-link">
            <p>Persistent</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#names-and-processes" class="md-toc-link"><p>Names And Processes</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#message-relaying" class="md-toc-link">
            <p>Message Relaying</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#" class="md-toc-link">
            <p>*</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#send-and-peek" class="md-toc-link"><p>Send and Peek</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#send-repeadtedly" class="md-toc-link"><p>Send Repeadtedly</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#persistent-send-syntax" class="md-toc-link">
            <p>Persistent send syntax</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#double-checking-a-message" class="md-toc-link">
            <p>Double Checking a Message</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#peek-syntax" class="md-toc-link">
            <p>Peek Syntax</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#join" class="md-toc-link"><p>Join</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#multiple-data-sources" class="md-toc-link"><p>Multiple data sources</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#rocket-launch" class="md-toc-link"><p>Rocket Launch</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#the-wrong-way" class="md-toc-link">
            <p>The wrong way</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#launch-solution" class="md-toc-link">
            <p>Launch Solution</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#unforgable-names" class="md-toc-link"><p>Unforgable Names</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#bound-and-free-variables" class="md-toc-link">
            <p>Bound and Free Variables</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#the-new-operator" class="md-toc-link">
            <p>The <code>new</code> Operator</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#private-vs-unforgeable" class="md-toc-link">
            <p>Private vs Unforgeable</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#acknowledgement-channels" class="md-toc-link"><p>Acknowledgement Channels</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#sending-names-gives-permission" class="md-toc-link">
            <p>Sending Names Gives Permission</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#stdoutack-and-stderrack" class="md-toc-link">
            <p><code>stdoutAck</code> and <code>stderrAck</code></p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#bundles-interpolation" class="md-toc-link"><p>Bundles Interpolation</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#stolen-messages" class="md-toc-link"><p>Stolen Messages</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#subscriptions" class="md-toc-link">
            <p>Subscriptions</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#jackpot" class="md-toc-link">
            <p>Jackpot</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#side-bar-string-operations" class="md-toc-link"><p>Side Bar: String Operations</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#imposter-throws" class="md-toc-link">
            <p>Imposter throws</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#public-key-crypto" class="md-toc-link">
            <p>Public Key Crypto</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#more-about-bundles" class="md-toc-link">
            <p>More About Bundles</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#state-channels" class="md-toc-link"><p>State Channels</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#holding-on-to-data" class="md-toc-link"><p>Holding on to data</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#persisting-data" class="md-toc-link">
            <p>Persisting Data</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#patience-game-revisited" class="md-toc-link">
            <p>Patience Game Revisited</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#objects-and-methods" class="md-toc-link"><p>Objects and Methods</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#factories" class="md-toc-link">
            <p>Factories</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#method-dispatching" class="md-toc-link">
            <p>Method Dispatching</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#object-capabilities" class="md-toc-link"><p>Object Capabilities</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#atc-revisited" class="md-toc-link">
            <p>ATC Revisited</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#savings-account" class="md-toc-link"><p>Savings Account</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#stealing-funds" class="md-toc-link">
            <p>Stealing Funds</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#two-kinds-of-factories" class="md-toc-link"><p>Two Kinds of Factories</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#abortable-rocket-launch" class="md-toc-link">
            <p>Abortable Rocket Launch</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#additional-syntax" class="md-toc-link"><p>Additional Syntax</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#binary-operators" class="md-toc-link">
            <p>Binary Operators</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#receiving-processes" class="md-toc-link">
            <p>Receiving Processes?</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ifs-and-conditions" class="md-toc-link">
            <p>Ifs and Conditions</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#comparison-operators--boolean-operators" class="md-toc-link">
            <p>Comparison Operators | Boolean Operators</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#pattern-matching" class="md-toc-link"><p>Pattern Matching</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#about-patterns" class="md-toc-link">
            <p>About Patterns</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#the-match-construct" class="md-toc-link"><p>The <code>match</code> construct</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#two-cases-weve-seen" class="md-toc-link">
            <p>Two cases we've seen</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#syntactic-sugar" class="md-toc-link">
            <p>Syntactic sugar</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#a-nicer-greeter" class="md-toc-link">
            <p>A Nicer Greeter</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#advanced-pattern-matching" class="md-toc-link">
            <p>Advanced pattern matching</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#unions-and-intersections" class="md-toc-link">
            <p>Unions and Intersections</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#more-about-bundles-1" class="md-toc-link">
            <p>More About Bundles</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#data-structures" class="md-toc-link"><p>Data Structures</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#string-methods" class="md-toc-link">
            <p>String Methods</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#tuples" class="md-toc-link">
            <p>Tuples</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#lists" class="md-toc-link">
            <p>Lists</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#sets" class="md-toc-link">
            <p>Sets</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#maps" class="md-toc-link">
            <p>Maps</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#sending-and-receiving-on-compound-names" class="md-toc-link">
            <p>Sending and Receiving on Compound Names</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#recursion" class="md-toc-link"><p>Recursion</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#iteration" class="md-toc-link">
            <p>Iteration</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#games" class="md-toc-link">
            <p>Games</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#off-chain" class="md-toc-link"><p>Off Chain</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#name-registry" class="md-toc-link">
            <p>Name Registry</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#examples" class="md-toc-link"><p>Examples</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#-1" class="md-toc-link">
            
          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    
</div>
<h2 id="sending">Sending </h2>
<h3 id="say-hello">Say hello </h3>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Hello World!"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="stdout">Stdout </h3>
<p>Rholang的核心是在信道(channel)上进行沟通，信道也就是我们用来发送与接受信息(message)的工具。而向信道上发送信息，我们采用 <code>!</code> 运算符。而 <code>stdout</code> 信道的创建让我们能够在控制台看到输出信息。而同时存放这些message的地方叫做元组空间(tuplespace)。</p>
<h3 id="concurency">Concurency </h3>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> chan1<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"I'm on the screen"</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>
  chan1<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"I'm in the tuplespace"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p><code>|</code> 运算符被称为'parallel'，也可以称作并行运算符。</p>
<h2 id="receiving">Receiving </h2>
<h3 id="check-for-messages">Check for messages </h3>
<p>一般而言，调用message的表达式如下：</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>message <span class="token operator">&lt;</span><span class="token operator">-</span> channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// Do something here</span>
<span class="token punctuation">}</span>
</code></pre><p>当一些message从channel中传出(show up)，那么message就进入了received状态。在花括号 <code>{}</code> 中的代码被称为continuation，它们会在message被received时被调用运行。其中的 <code>//</code> 为注释。</p>
<h3 id="comm-events">Comm Events </h3>
<p>以下的代码段向 <code>pizzaShop</code> 这个channel发送message，而这个channel在接收到信息后会将打印 <code>Order Received.</code></p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> pizzaShop<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span><span class="token punctuation">)</span> in <span class="token punctuation">{</span> 
    pizzaShop<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"2 medium pies"</span><span class="token punctuation">)</span> 
    <span class="token operator">|</span> 
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>order <span class="token operator">&lt;</span><span class="token operator">-</span> pizzaShop<span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Order Received."</span><span class="token punctuation">)</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre><h4 id="receiving-before-sending">Receiving Before Sending </h4>
<p>当发送与接受在同一个信道中发生，它被称为一个 <code>comm event</code>。</p>
<h3 id="contracts">Contracts </h3>
<p>智能合约能够让我们在部署一次代码之后，实现每次接收到信息时自动运行。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> coffeeShop<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  contract <span class="token function">coffeeShop</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Coffee Order Received"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  coffeeShop<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"one hot chocolate"</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>
  coffeeShop<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"two large cappuccinos please"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="persistent">Persistent </h4>
<p>实际上，Rholang中有两种不同风格的表达式来实现这种持久化行为。而现在我们可以认为以下两种形式是等价的，它们只在我们讨论区块链时有所不同：</p>
<p><code>contract coffeeShop(order) = {</code><br>
<code>for(order &lt;= coffeeShop) {</code></p>
<p>注意到第二种方式与此前使用 <code>for</code> 的方式有所不同，在这里我们使用 <code>&lt;=</code> 而不是 <code>&lt;-</code> 。</p>
<h2 id="names-and-processes">Names And Processes </h2>
<h3 id="message-relaying">Message Relaying </h3>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> alice<span class="token punctuation">,</span> bob<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  <span class="token comment">// Start the game by sending a message to Alice</span>
  alice<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"How to program: Change stuff and see what happens."</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>

  <span class="token comment">// Concurrently, Alice listens for the message</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>message <span class="token operator">&lt;</span><span class="token operator">-</span> alice<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// When she receives the message she'll pass it on to Bob</span>
    bob<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>message<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Concurrently, Bob will listens for the message</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>message <span class="token operator">&lt;</span><span class="token operator">-</span> bob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Bob is the last player, so he'll announce the message</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>message<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3>* {}</h3>
<p>在Rholang中有两种事务，为'channel'和'process'，而我们也可以通过特定方式转换它们。</p>
<p>一个'process'是任何rho代码片段，甚至可以仅仅是表示值(value)的代码。以下是一些示例：</p>
<pre data-role="codeBlock" data-info="" class="language-text text"><code>stdout!("Sup Rholang?") //A common send
Nil //The smallest possible process. It literally means "do nothing".
for(msg &lt;- phone){Nil} //A common receive that does nothing when a message arrives.
"Hello World" //Another small process that also does nothing. These are called "Ground Terms".
</code></pre><p>我们可以用 <code>@</code> 符号将process转为channel(也称name)。我们也可以用 <code>*</code> 将name转回process。</p>
<p>还有非常重要的一点是，在Rholang中我们<strong>发送processes而接受names</strong>。</p>
<h2 id="send-and-peek">Send and Peek </h2>
<h3 id="send-repeadtedly">Send Repeadtedly </h3>
<p>我们的披萨和咖啡店都希望在同一可重复使用的信道上接收许多消息。我们以持续的<code>(msg &lt;= chan){...}</code>或合约<code>Chan(msg){...}</code>来实现这一目标。</p>
<p>空中交通管制塔可能有兴趣做相反的事情——一遍又一遍地发送相同的信息。塔台的管制员希望记录一次包含天气和跑道动态信息的信息，并将其提供给每一位需要的飞行员。就像披萨店一样，他们很忙，每次飞行员使用信息时，他们都会不断地重新发送信息。</p>
<h4 id="persistent-send-syntax">Persistent send syntax </h4>
<p>对于上述的控制塔，它只需要修改一点点代码即可实现持续的发送同一个消息(也就是使用<code>!!</code>而不是<code>!</code>)：</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> airportInfo<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  <span class="token comment">// ATC sends the info</span>
  airportInfo<span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"No wind; Runway 11"</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>
  <span class="token comment">// Pilot receives the info</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>info <span class="token operator">&lt;</span><span class="token operator">-</span> airportInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>info<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="double-checking-a-message">Double Checking a Message </h4>
<p>持久的发送和接收非常有用，正如我刚刚展示的那样。但通常正常的发送和接收也很有用。想象一下，当天气变化时，空中交通管制员想要更新机场信息。如果他们使用持久发送，则无法进行更新。</p>
<p>一种更好的解决方式是使用常规的发送，并要求每个收到消息的飞行员在使用完毕消息后将消息放回信道。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> airportInfo<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  <span class="token comment">// ATC sends the info</span>
  airportInfo<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"No wind; Runway 11"</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>

  <span class="token comment">// Pilot receives the info</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>info <span class="token operator">&lt;</span><span class="token operator">-</span> airportInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>info<span class="token punctuation">)</span>
    <span class="token comment">// TODO Pilot MUST put the info back</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// ATC later records a new message</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>oldInfo <span class="token operator">&lt;</span><span class="token operator">-</span> airportInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    airportInfo<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Wind 3 knots; Runway 11"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="peek-syntax">Peek Syntax </h3>
<p>上面代码的一个问题是，健忘的飞行员可能不会真正将信息放回<code>airportInfo</code>信道，这会给其他需要信息的飞行员带来问题。更好的解决方案是一开始就不要真正从信道外接收消息。</p>
<p>要在不取出信道内容的情况下"窥探"信道上的内容，使用<code>&lt;&lt;-</code>运算符。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> airportInfo<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  <span class="token comment">// ATC sends the info</span>
  airportInfo<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"No wind; Runway 11"</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>

  <span class="token comment">// Pilot receives the info</span>
  <span class="token comment">// use a `&lt;&lt;-` there</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>info <span class="token operator">&lt;&lt;</span><span class="token operator">-</span> airportInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>info<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// ATC later records a new message</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>oldInfo <span class="token operator">&lt;</span><span class="token operator">-</span> airportInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    airportInfo<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Wind 3 knots; Runway 11"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="join">Join </h2>
<p>有时，只有在从两个或多个不同的数据源检索到数据(接收到消息)后才能进行计算。例如，在得到彩票号码和中奖号码之前，你无法判断自己是否中了彩票。在你知道价格和投标金额之前，你不能更改购买。在你知道每个选手完成了多少个俯卧撑之前，你无法判断谁赢得了俯卧撑比赛。</p>
<h3 id="multiple-data-sources">Multiple data sources </h3>
<p>Rholang拥有适用于这种情况的联接运算符。要执行联接，只需使用<code>;</code>运算符。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>p1Pushups <span class="token operator">&lt;</span><span class="token operator">-</span> player1<span class="token punctuation">;</span> p2Pushups <span class="token operator">&lt;</span><span class="token operator">-</span> player2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"The winner is..."</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>需要注意的是，当我们使用联接运算符，只有当所有messages都可用的时候message才会被接收。</p>
<h4 id="rocket-launch">Rocket Launch </h4>
<p>一家太空探索公司希望确保他们的火箭只有在两名飞行工程师Alice和Bob都下达发射命令时才能发射。例如，Bob会发送<code>bobLaunch!</code>。当两位工程师都发出命令时，火箭就可以发射了。</p>
<h5 id="the-wrong-way">The wrong way </h5>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token comment">// Listen for Alice's then Bob's launch commands</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span><span class="token operator">-</span> aliceLaunch<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>y <span class="token operator">&lt;</span><span class="token operator">-</span> bobLaunch<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Launching the rocket"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><p>在这种解决方案中，Alice将不能在中途修改她的想法，这是不合适的，我们应该采用 <code>;</code> 来解决这个问题。</p>
<h5 id="launch-solution">Launch Solution </h5>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> aliceLaunch<span class="token punctuation">,</span> bobLaunch<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  <span class="token comment">// Listen for both launch commands</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span><span class="token operator">-</span> aliceLaunch<span class="token punctuation">;</span> y <span class="token operator">&lt;</span><span class="token operator">-</span> bobLaunch<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Launching the rocket"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  <span class="token comment">// When ready, Engineers send their commands</span>
  aliceLaunch<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"launch"</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>
  bobLaunch<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"launch"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="unforgable-names">Unforgable Names </h2>
<p>我们已经学习了如何使用<code>for</code>和<code>contract</code>接收消息。这两种构造都"绑定"变量。如果变量附加了一个实际值(信道或进程)，则该变量被视为绑定变量。</p>
<h3 id="bound-and-free-variables">Bound and Free Variables </h3>
<p>而在Rholang中，以前面提到的咖啡店为例，<code>order</code>一开始为自由变量，但它在有信息传入<code>coffeeShop</code>的时候被绑定。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>order <span class="token operator">&lt;=</span> coffeeShop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Coffee Order Received"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// or the same is true when we use contracts.</span>
contract <span class="token function">coffeeShop</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Coffee Order Received"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="the-new-operator">The <code>new</code> Operator </h3>
<p>我们可以发现，<code>new</code>运算符同样也可以绑定变量。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> pizzaShop<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>

  <span class="token comment">// Same contract as before</span>
  contract <span class="token function">pizzaShop</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Order Received."</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  <span class="token comment">// Known customers can order because pizzaShop is bound here.</span>
  pizzaShop<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Extra bacon please"</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>
  pizzaShop<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Hawaiian Pizza to go"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>而当我们试着在<code>new</code>限制之外点一份披萨，会发生顶层自由变量的错误。<br>
在rholang中，使用<code>new</code>创建的channel不允许访问它们引用的底层process。如果你愿意，你可以把它们看作是"纯粹的信道"。</p>
<h3 id="private-vs-unforgeable">Private vs Unforgeable </h3>
<p><code>new</code>被称为限制运算符，因为它将创建的绑定名称的使用限制在大括号或"词法范围"内。在rholang的世界里，这些新名称实际上只在正确的范围内可见，但请记住，人类程序员可以从外部观察这个世界。在区块链环境中工作时尤其如此。</p>
<p>因此，虽然竞争对手的披萨店(从花括号外)不能消费为我们店准备的披萨订单，但他们仍然可以使用区块浏览器读取订单。程序员偶尔会称<code>new</code>名称为"私有"，但更好的术语是"不可伪造"(unforgetable)。</p>
<h3 id="acknowledgement-channels">Acknowledgement Channels </h3>
<p>unforgeable names的一个常见用法是"acknowledgement channels"，通常简称为"ack"通道。披萨店不应该通过打印到屏幕上来确认订单，打扰所有人，而应该让顾客知道订单已经下了。要做到这一点，披萨店需要知道如何联系顾客。因此，客户应该提供一个确认通道，以便回电。传统上，这样的通道被命名为<code>ack</code>。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> alice<span class="token punctuation">,</span> bob<span class="token punctuation">,</span> pizzaShop in <span class="token punctuation">{</span>

  <span class="token comment">// Now we take an order and an ack channel</span>
  contract <span class="token function">pizzaShop</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// Instead of acknowledging via stdout, we use ack</span>
    ack<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Order Received."</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Known customers can order because pizzaShop is bound here.</span>
  pizzaShop<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Extra bacon please"</span><span class="token punctuation">,</span> <span class="token operator">*</span>alice<span class="token punctuation">)</span>
  <span class="token operator">|</span>
  pizzaShop<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Hawaiian Pizza to go"</span><span class="token punctuation">,</span> <span class="token operator">*</span>bob<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="sending-names-gives-permission">Sending Names Gives Permission </h4>
<p>我们刚刚看到客户如何给商店一个ack信道来接收订单确认。根据我们之前的代码，Bob可以通过她的ack信道联系Alice。这意味着Bob可以发送一个伪造的ack，让Alice认为订单已经下了，而事实并非如此。实际上Alice和Bob应该严格控制他们不可伪造的名字。因为这个稳定的名字会让双方有能力进行沟通。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> pizzaShop in <span class="token punctuation">{</span>

  <span class="token comment">// Take orders and acknowledge them</span>
  contract <span class="token function">pizzaShop</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    ack<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Order Received."</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  
  <span class="token comment">// Order a pizza and send a private ack channel.</span>
  <span class="token keyword keyword-new">new</span> alice in <span class="token punctuation">{</span>
    pizzaShop<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"One medium veggie pizza"</span><span class="token punctuation">,</span> <span class="token operator">*</span>alice<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>解决方案是创建一个新的unforgeable name，然后将它传入pizzaShop合约从而使得pizzaShop可以调用这个名字。但是在这个例子中，我们选择相信shop只能在ack通道上发送，但请注意，如果它愿意，它也可以接收。我们将在下一节关于bundles的内容中学习如何只发送其中的一些权限。</p>
<h4 id="stdoutack-and-stderrack"><code>stdoutAck</code> and <code>stderrAck</code> </h4>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> myAckChannel<span class="token punctuation">,</span>
    <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">stdoutAck</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span>stdoutAck`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
    
  stdoutAck<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Print some words."</span><span class="token punctuation">,</span> <span class="token operator">*</span>myAckChannel<span class="token punctuation">)</span>
  <span class="token operator">|</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>acknowledgement <span class="token operator">&lt;</span><span class="token operator">-</span> myAckChannel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Received an acknowledgement."</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>值得注意的是，少数东西总是以新的元组空间开始，其中四个是用于屏幕打印通道的内置接收器。其他的用于cryptography。</p>
<h2 id="bundles-interpolation">Bundles Interpolation </h2>
<h3 id="stolen-messages">Stolen Messages </h3>
<p>Alice是一个正在崛起的名人，她收到粉丝们的来信。他们过去常常直接给她寄邮件。</p>
<p>但随着她越来越受欢迎，嫉妒她的竞争对手Eve开始偷她的邮件。</p>
<p>问题是，竞争对手可以收听Alice可以收听的同一频道。因此，她真正需要的是让她的粉丝们拥有一个"write-only bundle"</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> alice<span class="token punctuation">,</span> bob<span class="token punctuation">,</span> eve<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  <span class="token comment">// Alice gets a lot of fan mail, so she</span>
  <span class="token comment">// creates a new write only bundle and publishes it.</span>
  <span class="token keyword keyword-new">new</span> aliceFanMail in <span class="token punctuation">{</span>

    <span class="token comment">// Alice gives fanmail channel publicly</span>
    alice<span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>bundle<span class="token operator">+</span> <span class="token punctuation">{</span><span class="token operator">*</span>aliceFanMail<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">|</span>

    <span class="token comment">// Alice also reads fan mail</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>mail <span class="token operator">&lt;=</span> aliceFanMail<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Alice received a fanmail"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// When Bob wants to send fanmail he asks for the channel</span>
  <span class="token comment">// and then sends</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>aliceFanMail <span class="token operator">&lt;</span><span class="token operator">-</span> alice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    aliceFanMail<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Dear Alice, you're #TheBest"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Eve tries to intercept a message, but cannot</span>
  <span class="token comment">// because Alice's fanmail channel is write-only</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>aliceFanMail <span class="token operator">&lt;</span><span class="token operator">-</span> alice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@stolenMail <span class="token operator">&lt;=</span> aliceFanMail<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Eve stole a message: "</span><span class="token punctuation">,</span> stolenMail<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><code>bundle+ {*aliceFanMail}</code>是一个与<code>aliceFanMail</code>类似的频道，只是它只能被发送消息，而不能接收。</p>
<h4 id="subscriptions">Subscriptions </h4>
<p>上面的捆绑解决方案确实防止了Eve窃取邮件，这很好。但在区块链背景下，它也有一个不幸的副作用，即Alice必须付费才能发送她的粉丝邮件地址。区块链费用的作用有点像邮费。</p>
<p>Alice可以通过让粉丝向她索取粉丝邮件地址来节省邮费，然后他们将不得不支付交易成本，有点像寄一个已经盖了邮票的回信信封。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> alice<span class="token punctuation">,</span> bob<span class="token punctuation">,</span> eve<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>

  <span class="token comment">// Alice get a lot of fan mail, so she</span>
  <span class="token comment">// creates a new write only bundle and publishes it.</span>
  <span class="token keyword keyword-new">new</span> aliceFanMail in <span class="token punctuation">{</span>

    <span class="token comment">// Alice returns fanmail channel to any fan that asks</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-return">return</span> <span class="token operator">&lt;=</span> alice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span>bundle<span class="token operator">+</span> <span class="token punctuation">{</span><span class="token operator">*</span>aliceFanMail<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token operator">|</span>

    <span class="token comment">// Alice also reads fan mail</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>mail <span class="token operator">&lt;</span><span class="token operator">-</span> aliceFanMail<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Alice received a fanmail"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// When Bob wants to send fanmail he asks for the channel</span>
  <span class="token comment">// and then sends</span>
  <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-return">return</span> in <span class="token punctuation">{</span>
    alice<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">|</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>aliceFanMail <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      aliceFanMail<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Dear Alice, you're #TheBest"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Eve tries to intercept a message, but cannot</span>
  <span class="token comment">// because Alice's channel is write-only</span>
  <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-return">return</span> in <span class="token punctuation">{</span>
    alice<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">|</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>aliceFanMail <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@stolenMail <span class="token operator">&lt;=</span> aliceFanMail<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Eve stole a message: "</span><span class="token punctuation">,</span> stolenMail<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="jackpot">Jackpot </h4>
<p>如何将一条信息发送给多个人？我们在这里需要用到Peek的技巧。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-throw">throw</span><span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  <span class="token comment">// Throw the ball worth five points</span>
  <span class="token keyword keyword-throw">throw</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>

  <span class="token comment">// Throw the ball several more times</span>
  <span class="token keyword keyword-throw">throw</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">|</span>
  <span class="token keyword keyword-throw">throw</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">|</span>
  <span class="token keyword keyword-throw">throw</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">|</span>

  <span class="token comment">// Bill and Paige both try to catch</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>points <span class="token operator">&lt;=</span> <span class="token keyword keyword-throw">throw</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Bill caught it"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>points <span class="token operator">&lt;=</span> <span class="token keyword keyword-throw">throw</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Paige caught it"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>在这个例子中，<code>throw</code>是一个可以发送和接收的通道，它用来传递一些分数值。Bill和Paige都试图从<code>throw</code>上接收分数，并打印出相应的信息。但是，由于Rholang是一种并发语言，所以<code>throw</code>上的分数值可能会被两个人同时接收，也可能只被其中一个人接收。这取决于他们的执行顺序和竞争情况。为了避免这种不确定性，我们可以使用<code>bundle+</code>操作符将<code>throw</code>转换为一个只能发送不能接收的通道，然后将它公开给Bill和Paige。这样，他们就不能直接从<code>throw</code>上接收分数，而只能通过另一个通道来请求分数。这样就可以保证每个分数值只被一个人接收，并且可以控制分数的分配规则。例如，我们可以让第一个请求者得到最高的分数，或者随机地分配分数。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> <span class="token keyword keyword-throw">throw</span><span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">stdoutAck</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span>stdoutAck`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  <span class="token comment">// Throw the ball worth five points</span>
  <span class="token keyword keyword-throw">throw</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>

  <span class="token comment">// Throw the ball several more times</span>
  <span class="token keyword keyword-throw">throw</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">|</span>
  <span class="token keyword keyword-throw">throw</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">|</span>
  <span class="token keyword keyword-throw">throw</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">|</span>

  <span class="token comment">// Bill and Paige both try to catch</span>
  <span class="token comment">// But they cannot receive directly from throw</span>
  <span class="token comment">// They have to request the score from a bundled channel</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>bundledThrow <span class="token operator">&lt;=</span> bundle<span class="token operator">+</span><span class="token punctuation">{</span><span class="token operator">*</span><span class="token keyword keyword-throw">throw</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>request <span class="token operator">&lt;=</span> bundledThrow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>points <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token keyword keyword-throw">throw</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        request<span class="token operator">!</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Bill requests the score from the bundled channel</span>
  <span class="token keyword keyword-new">new</span> billRequest in <span class="token punctuation">{</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>bundledThrow <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token keyword keyword-throw">throw</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      bundledThrow<span class="token operator">!</span><span class="token punctuation">(</span>billRequest<span class="token punctuation">)</span>
      <span class="token operator">|</span>
      <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>points <span class="token operator">&lt;</span><span class="token operator">-</span> billRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Use stdoutAck to print the score and wait for the ack signal</span>
        <span class="token keyword keyword-new">new</span> ack in <span class="token punctuation">{</span>
          stdoutAck<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> <span class="token operator">*</span>ack<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token operator">|</span>
          <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> ack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Bill caught it"</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Paige requests the score from the bundled channel</span>
  <span class="token keyword keyword-new">new</span> paigeRequest in <span class="token punctuation">{</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>bundledThrow <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token keyword keyword-throw">throw</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      bundledThrow<span class="token operator">!</span><span class="token punctuation">(</span>paigeRequest<span class="token punctuation">)</span>
      <span class="token operator">|</span>
      <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>points <span class="token operator">&lt;</span><span class="token operator">-</span> paigeRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Use stdoutAck to print the score and wait for the ack signal</span>
        <span class="token keyword keyword-new">new</span> ack in <span class="token punctuation">{</span>
          stdoutAck<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> <span class="token operator">*</span>ack<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token operator">|</span>
          <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> ack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Paige caught it"</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><h3 id="side-bar-string-operations">Side Bar: String Operations </h3>
<p>大多数编程语言都允许将两个字符串连接在一起，rholang也不例外。我们可以<code>stdout！("Hello"++"world")</code>，但我们不能将字符串与int连接。</p>
<p>一种解决方案是使用stdoutAck和发送ack 。另一个选项是打印列表<code>stdout!(["Bill caught it. Points earned: ", *points])</code>。</p>
<p>最后一个选项是使用字符串插值。字符串插值允许我们将占位符放入字符串中，并使用映射将其替换为实际值。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>

  printStuff<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"noun"</span><span class="token operator">:</span> person<span class="token punctuation">,</span> <span class="token string">"adverb"</span><span class="token operator">:</span> sideways<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">|</span>
  
  contract <span class="token function">printStuff</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"The ${noun} jumped ${adverb}"</span> <span class="token operator">%</span><span class="token operator">%</span> <span class="token operator">*</span>map<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="imposter-throws">Imposter throws </h4>
<p>实际上，在上面的扔球实验中，我们可以发现任何人都可以加入并扔一个假球来捣乱，这与Eve偷取邮件例子是相反的。</p>
<p>所以在这里我们采用只读模式来转换<code>throw</code>信道，从而使其他人不能向其中写入。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> gameCh<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-throw">throw</span> in <span class="token punctuation">{</span>

    <span class="token comment">//Give out read-only access</span>
    gameCh<span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>bundle<span class="token operator">-</span> <span class="token punctuation">{</span><span class="token operator">*</span><span class="token keyword keyword-throw">throw</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">|</span>
    <span class="token comment">// Now actually make all the throws</span>
    <span class="token keyword keyword-throw">throw</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">|</span>
    <span class="token keyword keyword-throw">throw</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">|</span>
    <span class="token keyword keyword-throw">throw</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  <span class="token comment">// Bill and Paige join the game</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-throw">throw</span> <span class="token operator">&lt;</span><span class="token operator">-</span> gameCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>points <span class="token operator">&lt;=</span> <span class="token keyword keyword-throw">throw</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Bill caught it. Points: "</span><span class="token punctuation">,</span> <span class="token operator">*</span>points<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  <span class="token comment">// Eve tries to throw a fake, but can't</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-throw">throw</span> <span class="token operator">&lt;</span><span class="token operator">-</span> gameCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-throw">throw</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="public-key-crypto">Public Key Crypto </h3>
<p>在某些方面，只读捆绑包复制了公钥加密的签名功能。这里的中奖者确信球来自投掷者，因为只有他才能在投掷通道上发送，这很像加密签名。<br>
而在某些方面，只写捆绑包复制了公钥加密的加密功能。只有Alice才能接收粉丝邮件频道发送的信息。一个非常重要的区别是，在这里发送的消息在区块链之外是100%可见的！因此，虽然只写捆绑包是交流不可伪造姓名的有效方式，但它们不是策划抢劫或逃避政府监控的好方法。</p>
<h3 id="more-about-bundles">More About Bundles </h3>
<table>
<thead>
<tr>
<th>Syntax</th>
<th>Can Read</th>
<th>Can Write</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bundle- {proc}</code></td>
<td>YES</td>
<td>NO</td>
</tr>
<tr>
<td><code>bundle+ {proc}</code></td>
<td>NO</td>
<td>YES</td>
</tr>
<tr>
<td><code>bundle0 {proc}</code></td>
<td>NO</td>
<td>NO</td>
</tr>
<tr>
<td><code>bundle {proc}</code></td>
<td>YES</td>
<td>YES</td>
</tr>
</tbody>
</table>
<h2 id="state-channels">State Channels </h2>
<h3 id="holding-on-to-data">Holding on to data </h3>
<p>Rholang另一个特殊的点在于它没有传统的变量，而是仅仅使用元组空间来存储数据。每当需要临时存储某些数据，只需要将它发送到某个信道然后在需要使用的使用接收它就好了。而这样的信道我们就称为"state channels"，并且常在它们的名称后加"Ch"。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span><span class="token punctuation">,</span> boxCh in <span class="token punctuation">{</span>
  <span class="token comment">// To save data we just put it in the box</span>
  boxCh<span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>

  <span class="token comment">// Then to get data back out</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>data <span class="token operator">&lt;</span><span class="token operator">-</span> boxCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do whatever you want with the data here.</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="persisting-data">Persisting Data </h4>
<p>当我们再次检查上面代码中的 <code>boxCh</code>， 我们并不会得到一个结果，因为一旦我们接收了该消息，那么该消息就会从对应的元组空间中被使用掉。而为了持续使用数据，我们一般将一个copy传送回信道。</p>
<h3 id="patience-game-revisited">Patience Game Revisited </h3>
<p>在这里，我们用"state channel"的方式来解决我们之前提到的Patience Game。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> P1<span class="token punctuation">,</span> P2<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>

  <span class="token comment">// active gets its own scope so players can't change its value.</span>
  <span class="token keyword keyword-new">new</span> active in <span class="token punctuation">{</span>
    active<span class="token operator">!</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token operator">|</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> active<span class="token punctuation">;</span> _ <span class="token operator">&lt;</span><span class="token operator">-</span> P1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span> _ <span class="token operator">&lt;</span><span class="token operator">-</span> P2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"P2 Wins"</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token operator">|</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> active<span class="token punctuation">;</span> _ <span class="token operator">&lt;</span><span class="token operator">-</span> P2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> P1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"P1 Wins"</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  P1<span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span>
  <span class="token operator">|</span>
  P2<span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>在上面的代码中我们可以发现，在第一次调用<code>active</code>后，该<code>activeCh</code>变为空，也就能避免每个代码块都被调用一次。</p>
<h3 id="objects-and-methods">Objects and Methods </h3>
<p>在java等“面向对象编程”语言中，我们可以通过封装一些数据以及使用或更改数据的方法来对真实世界的对象进行建模。同样的事情在Rholang也是可能的。</p>
<p>在下面的例子中，创建了一个基本点击计数器对象：</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> currentCount<span class="token punctuation">,</span> increase<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> check<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  
  <span class="token comment">// Starting the counter at 0</span>
  currentCount<span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">|</span>

  <span class="token comment">// Method to increase counter (returns the old value)</span>
  contract <span class="token function">increase</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>old <span class="token operator">&lt;</span><span class="token operator">-</span> currentCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      currentCount<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>old <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span>
      ack<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>old<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token operator">|</span>

  <span class="token comment">// Method to reset the counter (returns the old value)</span>
  contract <span class="token function">reset</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>old <span class="token operator">&lt;</span><span class="token operator">-</span> currentCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      currentCount<span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">|</span>
      ack<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>old<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span> <span class="token operator">|</span>

  <span class="token comment">// Increase the value three times</span>
  <span class="token keyword keyword-new">new</span> ack in <span class="token punctuation">{</span>
    increase<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>ack<span class="token punctuation">)</span> <span class="token operator">|</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> ack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      increase<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>ack<span class="token punctuation">)</span> <span class="token operator">|</span>
      <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> ack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        increase<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>ack<span class="token punctuation">)</span> <span class="token operator">|</span>
        <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> ack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          increase<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>ack<span class="token punctuation">)</span> <span class="token operator">|</span>

          <span class="token comment">// And check it's value afterwards</span>
          <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> ack<span class="token punctuation">;</span> count <span class="token operator">&lt;</span><span class="token operator">-</span> currentCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>count<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> 
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="factories">Factories </h4>
<p>如果你已经用java等其他语言编程，你可能熟悉构造函数。而Rholang使用工厂来生成新对象，而不是构造函数。</p>
<p>计数器在rholang中是一个有用的构造，您可能会发现您在项目中使用了它。问题是，许多项目可能想要使用计数器，而只有一个计数器是不够的。因此，解决方案是签订一份制造柜台的工厂合同。当工厂合同被调用时，它会发回一个全新的计数器。也就是说，Rholang中也可以用到设计模式中的工厂模式。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> counterFactory<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  contract <span class="token function">counterFactory</span><span class="token punctuation">(</span>increase<span class="token punctuation">,</span> reset<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-new">new</span> currentCount in <span class="token punctuation">{</span>
      <span class="token comment">// Start the counter at zero</span>
      currentCount<span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">|</span>

      <span class="token comment">// Method to increase counter (returns the old value)</span>
      contract <span class="token function">increase</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>old <span class="token operator">&lt;</span><span class="token operator">-</span> currentCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          currentCount<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>old <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span>
          ack<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>old<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token operator">|</span>

      <span class="token comment">// Method to reset the counter (returns the old value)</span>
      contract <span class="token function">reset</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>old <span class="token operator">&lt;</span><span class="token operator">-</span> currentCount<span class="token punctuation">)</span><span class="token punctuation">{</span>
          currentCount<span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">|</span>
          ack<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>old<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token keyword keyword-new">new</span> ack<span class="token punctuation">,</span> myIncrease<span class="token punctuation">,</span> myReset in <span class="token punctuation">{</span>
    <span class="token comment">// Demo using the counter here</span>
    Nil
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>用户可以通过<code>counterFactory!(myIncrease, myReset)</code>来调用工厂获取一个新的计数器，他也可以通过<code>myReset!(*ack)</code>来重置上述创建的计数器。</p>
<h3 id="method-dispatching">Method Dispatching </h3>
<p>有两种主要技术可以使方法可用。第一个选项称之为“separation of powers”，因为每个方法都在自己的专用通道上侦听。另一种选择是“control panel”技术，其中有一个不可伪造的名称，称为控制面板，所有方法都建立在它之上。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token comment">// Separation of Powers</span>
contract <span class="token function">factory</span><span class="token punctuation">(</span>method1<span class="token punctuation">,</span> method2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  contract <span class="token function">method1</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
  contract <span class="token function">method2</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Control Panel</span>
contract <span class="token function">factory</span><span class="token punctuation">(</span>cPanel<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  contract @<span class="token punctuation">[</span>cPanel<span class="token punctuation">,</span> <span class="token string">"method1"</span><span class="token punctuation">]</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
  contract @<span class="token punctuation">[</span>cPanel<span class="token punctuation">,</span> <span class="token string">"method2"</span><span class="token punctuation">]</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>而上述计数器代码就使用了"Separation of Powers"来匹配模式。</p>
<h2 id="object-capabilities">Object Capabilities </h2>
<p>在本节，会学习放置在不可伪造名称上的方法如何产生一种非常有用的设计模式，称为“Object Capabilities”。</p>
<p>这种设计模式的一个非常常见的例子是汽车/房子的钥匙。处理这种对象让我们能够拥有进入房子/汽车的能力，而我们也能将这种对象传递/复制给其他人来让他们也拥有这种能力。</p>
<h3 id="atc-revisited">ATC Revisited </h3>
<p>接下来，将会重写此前碰到的空中交通控制例子。之前我们只能够传递信息，但是我们并不能更新我们的信息，所以接下来的代码将会完善这个功能。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> stationFactory<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  contract <span class="token function">stationFactory</span><span class="token punctuation">(</span>initialMessage<span class="token punctuation">,</span> getInfo<span class="token punctuation">,</span> setInfo<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-new">new</span> currentMessage in <span class="token punctuation">{</span>
      <span class="token comment">// Populate the initial message</span>
      currentMessage<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>initialMessage<span class="token punctuation">)</span>
      <span class="token operator">|</span>

      <span class="token comment">// Owner can update the message anytime</span>
      contract <span class="token function">setInfo</span><span class="token punctuation">(</span>newMessage<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>msg <span class="token operator">&lt;</span><span class="token operator">-</span> currentMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          currentMessage<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>newMessage<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token operator">|</span>

      <span class="token comment">// User tunes in for latest message</span>
      contract <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>msg <span class="token operator">&lt;</span><span class="token operator">-</span> currentMessage<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>msg<span class="token punctuation">)</span>
          <span class="token operator">|</span>
          currentMessage<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>msg<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Controllers create new station with private set capability</span>
  <span class="token comment">// and public get capability</span>
  <span class="token keyword keyword-new">new</span> airportInfo<span class="token punctuation">,</span> set in <span class="token punctuation">{</span>
    stationFactory<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Weather is nice"</span><span class="token punctuation">,</span> <span class="token operator">*</span>airportInfo<span class="token punctuation">,</span> <span class="token operator">*</span>set<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  <span class="token comment">// Listener tunes in to receive latest message</span>
  airportInfo<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token constant">stdout</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>使用只读bundle似乎很自然。但是，如果我们使用bundle，那么接收消息的第一个飞行员将从状态通道使用它。它不会留给其他飞行员接收。为了确保消息像我们想要的那样持久化，我们自己处理对状态信道的所有访问，并且只给飞行员查询正确消息的能力。</p>
<p>而在上述例子中，如果我们需要更新信息，只需要调用<code>set!("Strong crosswinds, be advised")</code>即可。</p>
<h3 id="savings-account">Savings Account </h3>
<p>在接下来的例子中，我们将会实现一个存储账户的例子，然后它将会有存钱、取钱以及查询余额的方法。而与计数器不同，一个账户是需要保证安全的，我们不希望任何人都能知道我们的余额，或者甚至从里面取钱。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> openAccount in <span class="token punctuation">{</span>
  <span class="token comment">// This contract registers a new account and creates its methods.</span>
  contract <span class="token function">openAccount</span><span class="token punctuation">(</span>initialDeposit<span class="token punctuation">,</span> deposit<span class="token punctuation">,</span> withdraw<span class="token punctuation">,</span> check<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-new">new</span> balanceCh in <span class="token punctuation">{</span>
      balanceCh<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>initialDeposit<span class="token punctuation">)</span>
      <span class="token operator">|</span>

      <span class="token comment">// Withdraw Contract</span>
      contract <span class="token function">withdraw</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>old <span class="token operator">&lt;</span><span class="token operator">-</span> balanceCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          balanceCh<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>old <span class="token operator">-</span> <span class="token operator">*</span>amount<span class="token punctuation">)</span> <span class="token operator">|</span>
          ack<span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// Deposit Contract</span>

      <span class="token comment">// Check contract</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Customer Sarah creates an uses an account</span>
  <span class="token keyword keyword-new">new</span> sarahDeposit<span class="token punctuation">,</span> sarahWithdraw<span class="token punctuation">,</span> sarahCheck<span class="token punctuation">,</span> ack in <span class="token punctuation">{</span>
    openAccount<span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">*</span>sarahDeposit<span class="token punctuation">,</span> <span class="token operator">*</span>sarahWithdraw<span class="token punctuation">,</span> <span class="token operator">*</span>sarahCheck<span class="token punctuation">)</span> <span class="token operator">|</span>
    sarahWithdraw<span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">*</span>ack<span class="token punctuation">)</span> <span class="token operator">|</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> ack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Nil<span class="token comment">// TODO check balance here</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>在上面的代码中，<code>openAccount</code>合约实际上是一个工厂。</p>
<h4 id="stealing-funds">Stealing Funds </h4>
<p>我们并不能想出任何其他人能够偷取Sarah的资金的方法，这是因为只有Sarah能够使用控制账户的unforgeable names。</p>
<p>而如果Sarah希望允许他的朋友Stephanie来向他的银行账户存钱但是不能查询/取钱，那么他需要将存钱对应的name传入朋友的命名空间。<br>
也就是调用<code>stephanie!(*sarahDeposit)</code>。</p>
<h3 id="two-kinds-of-factories">Two Kinds of Factories </h3>
<p>到目前为止，我们所有的工厂方法都要求我们输入构建合同的名称。在储蓄账户的例子中，这些名字分别是<code>check</code>、<code>deposit</code>和<code>withdraw</code>。我们可以称之为“BYOC”或“bring your own channel”工厂。BYOC技术的优点是，用户可以提供她喜欢的任何名称，包括她从其他合同或公共名称中获得的名称。</p>
<p>而另一种方式是允许工厂自行创建名称，并且将它传递回调用者。我们可以称之为"full service"工厂。如果我们对传入抽象名称的需求不高，我们完全可以使用这种全职工厂来减少麻烦。</p>
<h4 id="abortable-rocket-launch">Abortable Rocket Launch </h4>
<p>当我们第一次学习联接运算符时，我们考虑了一种情况，即两个运算符都必须获得发射火箭的许可。现在我们希望他们也能够收回许可。而解决的方法就是在它们给出发射命令时给运算符一个终止按钮。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> rocketFactory in <span class="token punctuation">{</span>

  <span class="token comment">// When a new rocket is setup, a launch capability for each for each operator is passed in</span>
  contract <span class="token function">rocketFactory</span><span class="token punctuation">(</span>aliceLaunch<span class="token punctuation">,</span> bobLaunch<span class="token punctuation">,</span> ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-new">new</span> aliceReadyCh<span class="token punctuation">,</span> bobReadyCh in <span class="token punctuation">{</span>
      <span class="token comment">// Start out neither ready</span>
      aliceReadyCh<span class="token operator">!</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token operator">|</span>
      bobReadyCh<span class="token operator">!</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token operator">|</span>

      contract <span class="token function">aliceLaunch</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-new">new</span> aliceAbort in <span class="token punctuation">{</span>
          <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> aliceReadyCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            aliceReadyCh<span class="token operator">!</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token operator">|</span>
          contract <span class="token function">aliceAbort</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> aliceReadyCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              aliceReadyCh<span class="token operator">!</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
              <span class="token operator">|</span>
              ack<span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token operator">|</span>
          ack<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>aliceAbort<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token operator">|</span>
      Nil <span class="token comment">// Bob contract goes here</span>
      <span class="token operator">|</span> ack<span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  <span class="token comment">// Make a new rocket to test</span>
  <span class="token keyword keyword-new">new</span> aliceLaunch<span class="token punctuation">,</span> bobLaunch<span class="token punctuation">,</span> ack in <span class="token punctuation">{</span>
    rocketFactory<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>aliceLaunch<span class="token punctuation">,</span> <span class="token operator">*</span>bobLaunch<span class="token punctuation">,</span> <span class="token operator">*</span>ack<span class="token punctuation">)</span><span class="token operator">|</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> ack<span class="token punctuation">)</span><span class="token punctuation">{</span>
      Nil <span class="token comment">// Tests go here</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="additional-syntax">Additional Syntax </h2>
<p>在本节，将会学习一些非常有用的表达式以便于我们能够实现一些常用的工具。</p>
<h3 id="binary-operators">Binary Operators </h3>
<p>第一个需要学习的是二元操作符。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> c2f<span class="token punctuation">,</span> f2c in <span class="token punctuation">{</span>

  <span class="token comment">/**
   * Converts Celcius temperatures to Farenheit. The conversion
   * multiply by 9/5 and add 32
   */</span>
  contract <span class="token function">c2f</span><span class="token punctuation">(</span>celcius<span class="token punctuation">,</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>celcius <span class="token operator">*</span> <span class="token number">9</span> <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  contract <span class="token function">f2c</span><span class="token punctuation">(</span>farenheit<span class="token punctuation">,</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    Nil <span class="token comment">// TODO you complete this contract</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token keyword keyword-new">new</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
    <span class="token comment">// 0 C should be 32 F</span>
    c2f<span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token constant">stdout</span><span class="token punctuation">)</span>
    <span class="token operator">|</span>
    <span class="token comment">// 100 C should be 212 F</span>
    c2f<span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token constant">stdout</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>最后一个需要知道的二元运算符是<code>++</code>，被用于关联/联接。这个操作符一般用于列表/字符串等。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> greeter in <span class="token punctuation">{</span>
  contract <span class="token function">greeter</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Hello there, "</span> <span class="token operator">++</span> <span class="token operator">*</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  <span class="token keyword keyword-new">new</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
    greeter<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Joshy"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token operator">|</span>
    greeter<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Tom"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token constant">stdout</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="receiving-processes">Receiving Processes? </h3>
<p><strong>我们总是发送process并且接收name！！！</strong></p>
<p>我们可以通过<code>@</code>运算符来将process转换为name，从而使它可以被接收，借助这个运算符我们可以完成如下工作：<code>for (@number &lt;- someChan){double!(2 * number)}</code>。</p>
<p>需要注意的是！虽然采用了 <code>@</code> 运算符，被修饰的process仍然是process，而 <code>@***</code>才是一个name。</p>
<h3 id="ifs-and-conditions">Ifs and Conditions </h3>
<p>类似于其他语言，Rholang中也有条件判断语句。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span> <span class="token comment">/* condition */</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Nil <span class="token comment">// Do this if condition is true</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
  Nil <span class="token comment">// Do this if condition is false</span>
<span class="token punctuation">}</span>
</code></pre><p>接下来一个例子展示了可以如何检查一个银行账户的状态：</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@balance <span class="token operator">&lt;=</span> @<span class="token string">"signTest"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>balance <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Account in good standing."</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
      <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Account overdrawn."</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">|</span>
@<span class="token string">"signTest"</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre><p>在上述例子中，我们也可以用<code>&gt;=</code>来修正账户余额为0时账户透支的Bug。</p>
<h3 id="comparison-operators--boolean-operators">Comparison Operators | Boolean Operators </h3>
<p>如下为一些比较运算符，值得注意的是，它们都可以用于数字或是文本字符串，不过文本字符串会按字典顺序排序，但是如果将文本与数字进行比较，那么进程将会终止：</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code>a <span class="token operator">&gt;</span> b <span class="token comment">//Is a greater than b?</span>
a <span class="token operator">&lt;</span> b <span class="token comment">//Is a less than b?</span>
a <span class="token operator">==</span> b <span class="token comment">//Is a equal to b?</span>
a <span class="token operator">&lt;=</span> b <span class="token comment">//Is a less than or equal to b?</span>
a <span class="token operator">&gt;=</span> b <span class="token comment">//Is a greater than or equal to b?</span>
a <span class="token operator">!=</span> b <span class="token comment">//Is a unequal to b?</span>
</code></pre><p>Rholang也有一些经典的布尔运算符例如AND,OR,NOT，运算的结果为true/false。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code>a <span class="token operator">and</span> b
a <span class="token operator">or</span> b
<span class="token operator">not</span> a
</code></pre><h2 id="pattern-matching">Pattern Matching </h2>
<p>模式在生活中随处可见，如果我们发现一款此前从未见过的新款汽车，我们仍然知道它是一辆汽车。这是因为它满足四个轮子、两个/四个门、一个挡风玻璃这样的模式。</p>
<h3 id="about-patterns">About Patterns </h3>
<p>Rholang允许程序员使用模式匹配来控制程序的执行。也就是说，不同的代码可以运行，这取决于进程是否匹配特定的模式。</p>
<h3 id="the-match-construct">The <code>match</code> construct </h3>
<p>Rholang中最常见的使用模式匹配的地方就是<code>match</code>。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> patternMatcher<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>

  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;=</span> patternMatcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   match <span class="token operator">*</span>x <span class="token punctuation">{</span>
    Nil       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Got the stopped process"</span><span class="token punctuation">)</span>
    <span class="token string">"hello"</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Got the string hello"</span><span class="token punctuation">)</span>
    <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>    <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Got a two-element list"</span><span class="token punctuation">)</span>
    Int       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Got an integer"</span><span class="token punctuation">)</span>
    _         <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Got something else"</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Make sure the pattern matcher works</span>
  patternMatcher<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>@<span class="token number">0</span> <span class="token operator">&lt;</span><span class="token operator">-</span> @<span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>
  patternMatcher<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">{</span>@<span class="token string">"world"</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>
  patternMatcher<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token operator">|</span><span class="token string">"hello"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>
  patternMatcher<span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>在上面的例子中，任何被<code>patternMatcher</code>信道接收的信息<code>x</code>都表示一个被引用的过程(process)。下划线只是填补空白，完全匹配任何模式。它被称为“通配符”，我们通常会将其视为匹配结构中的最终模式，以确保在没有其他匹配的情况下存在默认情况。</p>
<p>模式匹配也可以用于<code>for</code>或是<code>contract</code>。</p>
<h4 id="two-cases-weve-seen">Two cases we've seen </h4>
<p>在之前小节的例子中我们已经使用过下划线作为通配符了，例如<code>for (_ &lt;- ack)</code>，这意味着我们只关心我们收到了一个消息，而不关心消息内容是什么。</p>
<p>我们也在之前小节中使用模式匹配来接收process。当我们写<code>for (@p &lt;- x)</code>，它意味着接收任何匹配quoted process模式的信息，并且将该过程(process)与<code>p</code>绑定。</p>
<h4 id="syntactic-sugar">Syntactic sugar </h4>
<p>我们可以发现，<code>match</code>完全可以替代之前学的<code>if/else</code>。而实际上，<code>if/else</code>就是一种语法糖，以下两种代码是等效的：</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cond<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do Process P</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do Process Q</span>
<span class="token punctuation">}</span>

<span class="token comment">//or </span>

match cond <span class="token punctuation">{</span>
  <span class="token boolean">true</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token comment">// Do Process P</span>
  <span class="token boolean">false</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token comment">// Do Process Q</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="a-nicer-greeter">A Nicer Greeter </h4>
<p>以下是一个用到<code>++</code>运算符的例子，而在这个例子中的关键是，我们有两种不同的合约，但是它们在同一个信道<code>greeter</code>信道上监听：</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> greeter in <span class="token punctuation">{</span>
  contract <span class="token function">greeter</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Hello there, "</span> <span class="token operator">++</span> <span class="token operator">*</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  <span class="token comment">// Default case where there is no name</span>
  contract <span class="token function">greeter</span><span class="token punctuation">(</span><span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Hello there, world"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  <span class="token keyword keyword-new">new</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
    greeter<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Joshy"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token operator">|</span>
    greeter<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Tom"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token constant">stdout</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Rholang判断执行上述哪一个的关键是Rholang会执行满足我们传入参数的合约。</p>
<h4 id="advanced-pattern-matching">Advanced pattern matching </h4>
<p>我们可以用模式匹配做一些其他的事情，比如 <code>for(@{x!(P)} &lt;- y){ Q }</code>， 只有当在通道x上发送的进程与单个发送的模式匹配时，它才会减少。然后在过程(process)Q中，我们将绑定变量x、通道和P，即正在发送的过程(process)。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> patternMatcher<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>

  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;=</span> patternMatcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   match <span class="token operator">*</span>x <span class="token punctuation">{</span>
    Nil               <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Got the stopped process"</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>_<span class="token operator">!</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">}</span>           <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Got a send"</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span><span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>@<span class="token number">0</span> <span class="token operator">&lt;</span><span class="token operator">-</span> _<span class="token punctuation">)</span><span class="token punctuation">{</span>_<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Got a receive on @0"</span><span class="token punctuation">)</span>
    _                 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Got something else"</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Make sure the pattern matcher works</span>
  patternMatcher<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>@<span class="token number">0</span> <span class="token operator">&lt;</span><span class="token operator">-</span> @<span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>
  patternMatcher<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">{</span>@<span class="token string">"world"</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>
  patternMatcher<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token operator">|</span><span class="token string">"hello"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>
  patternMatcher<span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="unions-and-intersections">Unions and Intersections </h3>
<p>如果我们希望去匹配两个模式/或是两个都不匹配，那么我们需要用到并集与交集运算符。</p>
<p>要匹配几种模式中的任何一种，需要使用“并集”运算符<code>\/</code>，</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> <span class="token function">log</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span><span class="token punctuation">,</span> binderChecker in <span class="token punctuation">{</span>
  contract <span class="token function">binderChecker</span><span class="token punctuation">(</span>@data<span class="token punctuation">,</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    match data <span class="token punctuation">{</span>
      <span class="token string">"nombre"</span> \<span class="token operator">/</span> <span class="token string">"name"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"name-like"</span><span class="token punctuation">)</span>
      _ <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"not name-like"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  binderChecker<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token operator">*</span>log<span class="token punctuation">)</span>
  <span class="token operator">|</span>
  binderChecker<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"nombre"</span><span class="token punctuation">,</span> <span class="token operator">*</span>log<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>要同时匹配两种模式，需要使用“交集”运算符<code>/\</code>。在本例中，我们正在验证注册数据是否有效。注册人必须提供他们的姓名和年龄，并可以提供任何数量的额外数据。顺便说一下，这种存储键值数据的技术通常被称为“RHOCore”。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> <span class="token function">print</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-register">register</span> in <span class="token punctuation">{</span>

  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@<span class="token punctuation">{</span><span class="token punctuation">{</span>@<span class="token string">"name"</span><span class="token operator">!</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> _<span class="token punctuation">}</span> <span class="token operator">/</span>\ <span class="token punctuation">{</span>@<span class="token string">"age"</span><span class="token operator">!</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">|</span> _<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">&lt;=</span> <span class="token keyword keyword-register">register</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Both name and age were in the data"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token keyword keyword-register">register</span><span class="token operator">!</span><span class="token punctuation">(</span>@<span class="token string">"name"</span><span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>
  <span class="token keyword keyword-register">register</span><span class="token operator">!</span><span class="token punctuation">(</span>@<span class="token string">"age"</span><span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>
  <span class="token keyword keyword-register">register</span><span class="token operator">!</span><span class="token punctuation">(</span>@<span class="token string">"name"</span><span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span> <span class="token operator">|</span> @<span class="token string">"age"</span><span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token operator">|</span>
  <span class="token keyword keyword-register">register</span><span class="token operator">!</span><span class="token punctuation">(</span>@<span class="token string">"name"</span><span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span> <span class="token operator">|</span> @<span class="token string">"age"</span><span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span> <span class="token operator">|</span> @<span class="token string">"height"</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">175</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="more-about-bundles-1">More About Bundles </h3>
<p>此前我们讨论了bundles如何被用于创建只读/只写信道，但是我们仍然没有讨论他们的同名特性。bundle可以用来“捆绑”复合名称，这样它们就不会被模式匹配拆散。</p>
<p>在下面这个示例代码中，军队有一枚导弹，他们通过在unforgeable name上建立capability来保持对导弹发射的控制。由于外交关系，军队将允许公众检查导弹的安全性，但肯定不会发射。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> <span class="token function">log</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span><span class="token punctuation">,</span> missile in <span class="token punctuation">{</span>
  contract @<span class="token punctuation">(</span><span class="token operator">*</span>missile<span class="token punctuation">,</span> <span class="token string">"launch"</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    log<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"launching..."</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  contract @<span class="token punctuation">(</span><span class="token operator">*</span>missile<span class="token punctuation">,</span> <span class="token string">"inspect"</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    log<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"inspecting..."</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  contract @<span class="token string">"getInspectionChannel"</span><span class="token punctuation">(</span><span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>missile<span class="token punctuation">,</span> <span class="token string">"inspect"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>但是对于这个军队而言，他们有一个致命的错误！任何人都能启动他们的导弹！</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> getInspectionChannel<span class="token punctuation">,</span> ack in <span class="token punctuation">{</span>
  getInspectionChannel<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>ack<span class="token punctuation">)</span><span class="token operator">|</span>
  <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>@<span class="token punctuation">(</span>missile<span class="token punctuation">,</span> <span class="token string">"inspect"</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">-</span> ack<span class="token punctuation">)</span><span class="token punctuation">{</span>
    @<span class="token punctuation">(</span>missile<span class="token punctuation">,</span> <span class="token string">"launch"</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>而为了解决这个问题，军队给出了一个捆绑版本的复合名称，所以它不能再被模式匹配所分解。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> getInspectionChannel<span class="token punctuation">,</span> <span class="token function">log</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span><span class="token punctuation">,</span> missile in <span class="token punctuation">{</span>
  contract @<span class="token punctuation">(</span><span class="token operator">*</span>missile<span class="token punctuation">,</span> <span class="token string">"launch"</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    log<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"launching..."</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  contract @<span class="token punctuation">(</span><span class="token operator">*</span>missile<span class="token punctuation">,</span> <span class="token string">"inspect"</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    log<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"inspecting..."</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  contract <span class="token function">getInspectionChannel</span><span class="token punctuation">(</span><span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span>bundle<span class="token operator">+</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token operator">*</span>missile<span class="token punctuation">,</span> <span class="token string">"inspect"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="data-structures">Data Structures </h2>
<p>程序处理和存储真实世界的数据是很常见的。每当你有很多数据时，重要的是要把它整理好，这样你就可以快速找到你需要的信息。在模拟世界中，纸质文件通过堆叠、放在文件夹和文件柜中来保持组织。同样的概念也适用于编程，rholang也不例外，rholang也有自己的数据结构！</p>
<h3 id="string-methods">String Methods </h3>
<p>与其他数据结构一样，字符串拥有执行操作的方法。</p>
<p>字符串的<code>length</code>方法告诉我们字符串中有多少字符，<code>slice</code>方法创建一个原字符串切割后的新字符串。同时，字符串也支持<code>++</code>运算符用于连接字符串。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> wordLength<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  contract <span class="token function">wordLength</span><span class="token punctuation">(</span>@word<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"How many characters in "</span> <span class="token operator">++</span> word<span class="token punctuation">)</span><span class="token operator">|</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span>word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">|</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Shorter version: "</span> <span class="token operator">++</span> word<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  wordLength<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Cantaloupe"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>字符串还有一个名为<code>hexToBytes</code>的方法，用于处理包含有效十六进制数的字符串。它返回一个由该十六进制数表示的字节数组。切割字符数组也是可以的。</p>
<h3 id="tuples">Tuples </h3>
<p>元组中的项数称为arity。元组按顺序包含多条数据。它们总是固定的arity，并且方法相对较少。因此，它们是最不有趣的数据结构，但同时也是最基本的。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> tCh<span class="token punctuation">,</span> <span class="token function">print</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>

  tCh<span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">|</span>

  <span class="token comment">// Test nth</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@t <span class="token operator">&lt;</span><span class="token operator">-</span> tCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test nth. Expected: 5. Got "</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">nth</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test toByteArray</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@t <span class="token operator">&lt;</span><span class="token operator">-</span> tCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"toByteArray test. Got: "</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="lists">Lists </h3>
<p>列表与元组很像，但是列表是由方括号建立的，它们有更多的方法。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> lCh<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>

  <span class="token comment">// Make a new list, l</span>
  lCh<span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">|</span>

  <span class="token comment">// Test nth</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@l <span class="token operator">&lt;</span><span class="token operator">-</span> lCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Test nth. Expected: 5. Got: ${ans}"</span> <span class="token operator">%</span><span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">"ans"</span><span class="token operator">:</span> l<span class="token punctuation">.</span><span class="token function">nth</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test toByteArray</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@l <span class="token operator">&lt;</span><span class="token operator">-</span> lCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test toByteArray. Got: "</span><span class="token punctuation">,</span> l<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test slice</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@l <span class="token operator">&lt;</span><span class="token operator">-</span> lCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test slice. Expected: [4, 5]. Got: "</span><span class="token punctuation">,</span> l<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test length</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@l <span class="token operator">&lt;</span><span class="token operator">-</span> lCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Test length. Expected: 3. Got: '${ans}"</span> <span class="token operator">%</span><span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">"ans"</span><span class="token operator">:</span> l<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>而在下面这个例子中，用户每次跑步经过他们跑步的距离时都会调用合同。合同将在一个列表中记录所有跑步情况。我们还可以编写方法来获取所有跑步数据，或者获取用户跑步的总距离。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> logRun<span class="token punctuation">,</span> runsCh<span class="token punctuation">,</span> totalDistanceCh in <span class="token punctuation">{</span>
  <span class="token comment">// Initialize an empty list for runs</span>
  runsCh<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span>

  <span class="token comment">// Initialize a channel for total distance</span>
  totalDistanceCh<span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">|</span>

  contract <span class="token function">logRun</span><span class="token punctuation">(</span>distance<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the current list of runs</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@runs <span class="token operator">&lt;</span><span class="token operator">-</span> runsCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Append the new distance to the list</span>
      <span class="token keyword keyword-new">new</span> updatedRuns in <span class="token punctuation">{</span>
        updatedRuns<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span>distance<span class="token punctuation">]</span> <span class="token operator">++</span> runs<span class="token punctuation">)</span> <span class="token operator">|</span>
        <span class="token comment">// Update the stored list of runs</span>
        runsCh<span class="token operator">!</span><span class="token punctuation">(</span>updatedRuns<span class="token punctuation">)</span> <span class="token operator">|</span>

        <span class="token comment">// Calculate and update total distance</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@totalDistance <span class="token operator">&lt;</span><span class="token operator">-</span> totalDistanceCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword keyword-new">new</span> updatedTotalDistance in <span class="token punctuation">{</span>
            updatedTotalDistance<span class="token operator">!</span><span class="token punctuation">(</span>totalDistance <span class="token operator">+</span> distance<span class="token punctuation">)</span> <span class="token operator">|</span>
            totalDistanceCh<span class="token operator">!</span><span class="token punctuation">(</span>updatedTotalDistance<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Contract to get the total distance</span>
  contract <span class="token function">getTotalDistance</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@totalDistance <span class="token operator">&lt;</span><span class="token operator">-</span> totalDistanceCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ret<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>totalDistance<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><h3 id="sets">Sets </h3>
<p>集合在某些方面与列表相似，但最大的区别是集合没有排序。集合是进程的集合，但集合中没有第一项或最后一项。集合中也不允许重复。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> sCh<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>

  sCh<span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">|</span>

  <span class="token comment">// Test toByteArray</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@s <span class="token operator">&lt;</span><span class="token operator">-</span> sCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test toByteArray. Got: "</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test Add</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@s <span class="token operator">&lt;</span><span class="token operator">-</span> sCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test add. Expected Set(3, 4, 5, 6), Got: "</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test Diff</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@s <span class="token operator">&lt;</span><span class="token operator">-</span> sCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test diff. Expected: Set(5) Got: "</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">diff</span><span class="token punctuation">(</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test Union</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@s <span class="token operator">&lt;</span><span class="token operator">-</span> sCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test union. Expected: Set(1, 2, 3, 4, 5). Got: "</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token keyword keyword-union">union</span><span class="token punctuation">(</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test Delete</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@s <span class="token operator">&lt;</span><span class="token operator">-</span> sCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test delete. Expected: Set(3, 4). Got: "</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token keyword keyword-delete">delete</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test Contains</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@s <span class="token operator">&lt;</span><span class="token operator">-</span> sCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test contains. Expected: true. Got:"</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">|</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test contains. Expected: false. Got: "</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test Size</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@s <span class="token operator">&lt;</span><span class="token operator">-</span> sCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Test size. Expected 3. Got: ${ans}"</span> <span class="token operator">%</span><span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">"ans"</span><span class="token operator">:</span> s<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="maps">Maps </h3>
<p>图与集合很像，但是它们包含键值对。图也是无序的。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> mCh<span class="token punctuation">,</span> <span class="token function">print</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>

  mCh<span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">|</span>

  <span class="token comment">// Test toByteArray</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@m <span class="token operator">&lt;</span><span class="token operator">-</span> mCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test toByteArray. Got: "</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test Union</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@m <span class="token operator">&lt;</span><span class="token operator">-</span> mCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test union. Expected: {a: 3, b: 4, c: 5, d: 6}. Got: "</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token keyword keyword-union">union</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"d"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test Diff</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@m <span class="token operator">&lt;</span><span class="token operator">-</span> mCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test diff. Expected: {b: 4, c: 5}. Got: "</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">diff</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"a"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test Delete</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@m <span class="token operator">&lt;</span><span class="token operator">-</span> mCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test delete. Expected: {a: 3, b: 4}. Got: "</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token keyword keyword-delete">delete</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test Contains</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@m <span class="token operator">&lt;</span><span class="token operator">-</span> mCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test contains. Expected: true. Got: "</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">|</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test contains. Expected: false. Got: "</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test Get</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@m <span class="token operator">&lt;</span><span class="token operator">-</span> mCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test get. Expected: 4. Got: "</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test GetOrElse</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@m <span class="token operator">&lt;</span><span class="token operator">-</span> mCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"getOrElseSuccessful. Expected: 4. Got: "</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">getOrElse</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"?"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">|</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"getOrElseFailed. Expected: ?. Got: "</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">getOrElse</span><span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token string">"?"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test Set</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@m <span class="token operator">&lt;</span><span class="token operator">-</span> mCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test set. Expected {a: 3, b: 2, c: 5}. Got: "</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test Keys</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@m <span class="token operator">&lt;</span><span class="token operator">-</span> mCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test keys. Expected Set(a, b, c)). Got: "</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>

  <span class="token comment">// Test Size</span>
  <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@m <span class="token operator">&lt;</span><span class="token operator">-</span> mCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
    print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Test size. Expected 3. Got: "</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>为了证明地图在rholang中的有用性，让我们考虑一下这个合同，它可以查找任何国家的首都。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> capitalOf<span class="token punctuation">,</span> <span class="token function">print</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  <span class="token keyword keyword-new">new</span> mapCh in <span class="token punctuation">{</span>

    <span class="token comment">// Use a persistent send instead of peeking later</span>
    mapCh<span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"Canada"</span><span class="token operator">:</span> <span class="token string">"Ottawa"</span><span class="token punctuation">,</span>
             <span class="token string">"Nigeria"</span><span class="token operator">:</span> <span class="token string">"Abuja"</span><span class="token punctuation">,</span>
             <span class="token string">"Germany"</span><span class="token operator">:</span> <span class="token string">"Berlin"</span><span class="token punctuation">,</span>
             <span class="token string">"Antarctica"</span><span class="token operator">:</span> Nil<span class="token punctuation">,</span>
             <span class="token string">"China"</span><span class="token operator">:</span> <span class="token string">"Beijing"</span><span class="token punctuation">,</span>
             <span class="token string">"Ecuador"</span><span class="token operator">:</span> <span class="token string">"Quito"</span><span class="token punctuation">,</span>
             <span class="token string">"Australia"</span><span class="token operator">:</span> <span class="token string">"Canberra"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">|</span>
    contract <span class="token function">capitalOf</span><span class="token punctuation">(</span>@country<span class="token punctuation">,</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@map <span class="token operator">&lt;</span><span class="token operator">-</span> mapCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">getOrElse</span><span class="token punctuation">(</span>country<span class="token punctuation">,</span> <span class="token string">"I don't know"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token operator">|</span>
  <span class="token keyword keyword-new">new</span> answerCh in <span class="token punctuation">{</span>
    capitalOf<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Canada"</span><span class="token punctuation">,</span> <span class="token operator">*</span>answerCh<span class="token punctuation">)</span><span class="token operator">|</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@cap <span class="token operator">&lt;</span><span class="token operator">-</span> answerCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Capital of ${cntry} is ${cap}."</span> <span class="token operator">%</span><span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">"cntry"</span><span class="token operator">:</span> <span class="token string">"Canada"</span><span class="token punctuation">,</span> <span class="token string">"cap"</span><span class="token operator">:</span> cap<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>从上面的示例代码开始，以下是一个“国家和首都”智力竞赛游戏的示例，用户调用一份合同，并返回一个挑战国家和一个回答频道。然后，用户通过回答通道发回她对该国首都的最佳猜测，并返回一个布尔值，以确定她是否正确。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> capitalOf<span class="token punctuation">,</span> <span class="token function">print</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  <span class="token keyword keyword-new">new</span> mapCh in <span class="token punctuation">{</span>
    <span class="token comment">// Initialize the map of countries and capitals</span>
    mapCh<span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"Canada"</span><span class="token operator">:</span> <span class="token string">"Ottawa"</span><span class="token punctuation">,</span>
             <span class="token string">"Nigeria"</span><span class="token operator">:</span> <span class="token string">"Abuja"</span><span class="token punctuation">,</span>
             <span class="token string">"Germany"</span><span class="token operator">:</span> <span class="token string">"Berlin"</span><span class="token punctuation">,</span>
             <span class="token string">"Antarctica"</span><span class="token operator">:</span> Nil<span class="token punctuation">,</span>
             <span class="token string">"China"</span><span class="token operator">:</span> <span class="token string">"Beijing"</span><span class="token punctuation">,</span>
             <span class="token string">"Ecuador"</span><span class="token operator">:</span> <span class="token string">"Quito"</span><span class="token punctuation">,</span>
             <span class="token string">"Australia"</span><span class="token operator">:</span> <span class="token string">"Canberra"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// Contract to get a random country challenge</span>
    contract <span class="token function">getRandomCountry</span><span class="token punctuation">(</span><span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@map <span class="token operator">&lt;</span><span class="token operator">-</span> mapCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Get a random country from the map</span>
        <span class="token keyword keyword-new">new</span> countries in <span class="token punctuation">{</span>
          countries<span class="token operator">!</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
          <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@country <span class="token operator">&lt;</span><span class="token operator">-</span> countries<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span>country<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Contract to check if the user's guess is correct</span>
    contract <span class="token function">checkGuess</span><span class="token punctuation">(</span>@country<span class="token punctuation">,</span> @guess<span class="token punctuation">,</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@map <span class="token operator">&lt;</span><span class="token operator">-</span> mapCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        match map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>country<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">Some</span><span class="token punctuation">(</span>capital<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span>guess <span class="token operator">==</span> capital<span class="token punctuation">)</span>
          None <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token operator">|</span>

  <span class="token keyword keyword-new">new</span> answerCh in <span class="token punctuation">{</span>
    <span class="token comment">// Get a random country challenge</span>
    getRandomCountry<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>answerCh<span class="token punctuation">)</span> <span class="token operator">|</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@challengeCountry <span class="token operator">&lt;</span><span class="token operator">-</span> answerCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// User sends their guess for the capital</span>
      <span class="token keyword keyword-new">new</span> userGuess in <span class="token punctuation">{</span>
        userGuess<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Canada"</span><span class="token punctuation">,</span> <span class="token operator">*</span>answerCh<span class="token punctuation">)</span> <span class="token operator">|</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@guess <span class="token operator">&lt;</span><span class="token operator">-</span> answerCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// Check if the guess is correct</span>
          checkGuess<span class="token operator">!</span><span class="token punctuation">(</span>challengeCountry<span class="token punctuation">,</span> guess<span class="token punctuation">,</span> <span class="token operator">*</span>answerCh<span class="token punctuation">)</span> <span class="token operator">|</span>
          <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>@correct <span class="token operator">&lt;</span><span class="token operator">-</span> answerCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            print<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Is ${cntry}'s capital ${cap}? Answer: ${correct}"</span> <span class="token operator">%</span><span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">"cntry"</span><span class="token operator">:</span> challengeCountry<span class="token punctuation">,</span> <span class="token string">"cap"</span><span class="token operator">:</span> guess<span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><h3 id="sending-and-receiving-on-compound-names">Sending and Receiving on Compound Names </h3>
<p>在本节中，我们了解了几个有趣的数据结构。数据结构是像整数、布尔值和零一样的过程(process)。因此，它们可以像所有其他过程(process)一样被引用并转化为名称。我们可以用这些名字建立合同，就像我们可以用任何其他名字一样。建立在元组等数据结构上的名称通常称为复合名称。</p>
<p>在这个例子中，Alice和Bob各有一个不可伪造的名字（我称之为key）。键本身可能很有用（对于代码片段中未显示的内容），但只有当它们一起使用时，才能调用显示的contract。这被称为“权利放大”。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> alice<span class="token punctuation">,</span> bob<span class="token punctuation">,</span> key1<span class="token punctuation">,</span> key2<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>

  alice<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>key1<span class="token punctuation">)</span><span class="token operator">|</span>
  bob<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>key2<span class="token punctuation">)</span><span class="token operator">|</span>

  contract @<span class="token punctuation">(</span><span class="token operator">*</span>key1<span class="token punctuation">,</span> <span class="token operator">*</span>key2<span class="token punctuation">)</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">"Congratulations, Alice and Bob, you've cooperated."</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="recursion">Recursion </h2>
<p>许多编程语言使用迭代作为控制程序流的基本方式。迭代本质上意味着对一个项目进行一个过程，然后对下一个项目再进行下一个。因为rholang是一种完全并发的编程语言，所以这是不可能的。</p>
<p>这里官方文档be了🤣</p>
<h3 id="iteration">Iteration </h3>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> iterate in <span class="token punctuation">{</span>
    contract <span class="token function">iterate</span><span class="token punctuation">(</span>@list<span class="token punctuation">,</span> process<span class="token punctuation">,</span> done<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      match list <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>hd<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>tl<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword keyword-new">new</span> ack in <span class="token punctuation">{</span>
            process<span class="token operator">!</span><span class="token punctuation">(</span>hd<span class="token punctuation">,</span> <span class="token operator">*</span>ack<span class="token punctuation">)</span> <span class="token operator">|</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> ack<span class="token punctuation">)</span> <span class="token punctuation">{</span> iterate<span class="token operator">!</span><span class="token punctuation">(</span>tl<span class="token punctuation">,</span> <span class="token operator">*</span>process<span class="token punctuation">,</span> <span class="token operator">*</span>done<span class="token punctuation">)</span> <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        _ <span class="token operator">=</span><span class="token operator">&gt;</span> done<span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token operator">|</span>
    <span class="token keyword keyword-new">new</span> process<span class="token punctuation">,</span> done in <span class="token punctuation">{</span>
      iterate<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">*</span>process<span class="token punctuation">,</span> <span class="token operator">*</span>done<span class="token punctuation">)</span> <span class="token operator">|</span>
      contract <span class="token function">process</span><span class="token punctuation">(</span>@item<span class="token punctuation">,</span> ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">/* handle processing of item */</span>
        ack<span class="token operator">!</span><span class="token punctuation">(</span>Nil<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token operator">|</span>
      <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>_ <span class="token operator">&lt;</span><span class="token operator">-</span> done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* done! */</span>
        Nil
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><h2 id="games">Games </h2>
<p>这里也be了🤷‍♀️</p>
<h2 id="off-chain">Off Chain </h2>
<p>到目前为止，我们所有的练习都完全存在于rholang的世界里。虽然rholang是一种通用编程语言，但它目前的作用是作为一种区块链语言。许多精彩的智能合约正在用rholang编写。当他们在做那些真实世界的事情时，他们需要一个地方来存储他们不可伪造的名字。因为不可伪造的名字只能存在于区块链上。</p>
<h3 id="name-registry">Name Registry </h3>
<p>Name Registry为该问题提供了部分解决方案。要注册名称，请遵循以下示例。</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> doubler<span class="token punctuation">,</span>
  uriChan<span class="token punctuation">,</span>
  <span class="token function">insertArbitrary</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>registry<span class="token operator">:</span>insertArbitrary`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>

   <span class="token comment">// This is a silly contract that we'll register</span>
  contract <span class="token function">doubler</span><span class="token punctuation">(</span>@n <span class="token operator">/</span>\ Int<span class="token punctuation">,</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token operator">|</span>

  <span class="token comment">// Tell the registry that we want to register</span>
  <span class="token comment">// give URI back on uriChan</span>
  insertArbitrary<span class="token operator">!</span><span class="token punctuation">(</span>bundle<span class="token operator">+</span><span class="token punctuation">{</span><span class="token operator">*</span>doubler<span class="token punctuation">}</span>  <span class="token punctuation">,</span> <span class="token operator">*</span>uriChan<span class="token punctuation">)</span> <span class="token operator">|</span>
 
  <span class="token comment">// Wait for URI response</span>
  <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>@uri <span class="token operator">&lt;</span><span class="token operator">-</span> uriChan<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">stdout</span><span class="token operator">!</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>而如果要查找名称以便以后使用</p>
<pre data-role="codeBlock" data-info="c++" class="language-cpp c++"><code><span class="token keyword keyword-new">new</span> doublerCh<span class="token punctuation">,</span>
  <span class="token function">lookup</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>registry<span class="token operator">:</span>lookup`<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token constant">stdout</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>io<span class="token operator">:</span><span class="token constant">stdout</span>`<span class="token punctuation">)</span> in <span class="token punctuation">{</span>
  
  <span class="token comment">// Ask the registry to lookup the URI and send the contract back on doublerCh</span>
  lookup<span class="token operator">!</span><span class="token punctuation">(</span>`rho<span class="token operator">:</span>id<span class="token operator">:</span>fos1m8yaki3s8g1ytzkr6boucnhab6nafoco8ww63xqj5k8aa1xfza`<span class="token punctuation">,</span> <span class="token operator">*</span>doublerCh<span class="token punctuation">)</span> <span class="token operator">|</span>

  <span class="token comment">// Wait to receive the answer back from the registry</span>
  <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span> doubler <span class="token operator">&lt;</span><span class="token operator">-</span> doublerCh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// Double a number and send the answer to stdout</span>
    doubler<span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token constant">stdout</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>具体细节无从得知，因为作者认为现在的Rholang还很有安全风险，他没摆出来。</p>
<h2 id="examples">Examples </h2>
<h3 id="-1"></h3>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// @ts-check</span>

<span class="token comment">// TODO: rholang goes in .rho files</span>

<span class="token comment">// TODO: expression macros, blockly UX</span>
<span class="token doc-comment comment">/** <span class="token keyword keyword-@type">@type</span> <span class="token class-name"><span class="token punctuation">{</span> FieldSpec <span class="token punctuation">}</span></span> */</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">KudosReg</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'uri'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'rho:id:eifmzammsbx8gg5fjghjn34pw6hbi6hqep7gyk4bei96nmra11m4hi'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** <span class="token keyword keyword-@type">@type</span> <span class="token class-name"><span class="token punctuation">{</span> FieldSpec <span class="token punctuation">}</span></span> */</span>
<span class="token keyword keyword-const">const</span> rollReg <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'uri'</span><span class="token punctuation">,</span>
  <span class="token comment">// AGM2020 voter list on mainnet</span>
  <span class="token comment">// value: 'rho:id:admzpibb3gxxp18idri7h6eneg4io6myfmcmjhufc6asy73bgrojop',</span>
  <span class="token comment">// testnet</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'rho:id:kiijxigqydnt7ds3w6w3ijdszswfysr3hpspthuyxz4yn3ksn4ckzf'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword keyword-@typedef">@typedef</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token punctuation">{</span> template<span class="token operator">:</span> string<span class="token punctuation">,</span> fields<span class="token operator">?</span><span class="token operator">:</span> Record<span class="token punctuation">&lt;</span>string<span class="token punctuation">,</span> FieldSpec<span class="token punctuation">&gt;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token class-name">ActionSpec</span>
 * <span class="token keyword keyword-@typedef">@typedef</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'string'</span> <span class="token operator">|</span> <span class="token string">'uri'</span> <span class="token operator">|</span> <span class="token string">'walletRevAddr'</span><span class="token punctuation">,</span> value<span class="token operator">?</span><span class="token operator">:</span> string <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token class-name">FieldSpec</span>
 * <span class="token keyword keyword-@type">@type</span> <span class="token class-name"><span class="token punctuation">{</span>Record<span class="token punctuation">&lt;</span>string<span class="token punctuation">,</span> ActionSpec<span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span>
 */</span>
<span class="token keyword module keyword-export">export</span> <span class="token keyword keyword-const">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">newMemberDirectory</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">contractURI</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// testnet</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'rho:id:mjebrofc8ns955mpdjnpakgpc4nkcqra14wqwtskp7swj46szx5x1i'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'uri'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      rollReg<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">new return(\`rho:rchain:deployId\`), lookup(\`rho:registry:lookup\`), regCh
    in {
      lookup!(contractURI, *regCh) | for (MemberDirectory &lt;- regCh) {
        MemberDirectory!("makeFromURI", rollReg, *return)
      }
    }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">claimWithInbox</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">myGovRevAddr</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'walletRevAddr'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dirURI</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// testnet</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'rho:id:mjebrofc8ns955mpdjnpakgpc4nkcqra14wqwtskp7swj46szx5x1i'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'uri'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">new return, lookup(\`rho:registry:lookup\`), regCh in {
      lookup!(dirURI, *regCh) | for (memDir &lt;- regCh) {
        memDir!("setup", myGovRevAddr, *return)
      }
    }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">helloWorld</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">new world in { world!("Hello!") }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token literal-property property">raviWorld</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">new ravi in { ravi!("Hello!") }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">getRoll</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      rollReg<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    new ret, ch, lookup(\`rho:registry:lookup\`) in {
      lookup!(rollReg, *ch) |
      for (@set &lt;- ch) {
        ret!(["#define", "$roll", set.toList()])
      }
    }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">peekKudos</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token maybe-class-name">KudosReg</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    new return,
      lookup(\`rho:registry:lookup\`), ch
    in {
      lookup!(KudosReg, *ch) | for (Kudos &lt;- ch) {
        Kudos!("peek", *ch) | for (@current &lt;-ch ) {
          return!(["#define", "$kudos", current])
        }
      }
    }
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">awardKudos</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">them</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token maybe-class-name">KudosReg</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    new deployId(\`rho:rchain:deployId\`),
      lookup(\`rho:registry:lookup\`), ch
    in {
      lookup!(KudosReg, *ch) | for (Kudos &lt;- ch) {
        Kudos!("award", them, *ch) | for (@current &lt;- ch) {
          deployId!(["#define", "$kudos", current])
        }
      }
    }
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">checkBalance</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">myGovRevAddr</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'walletRevAddr'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">new return, lookup(\`rho:registry:lookup\`), RevVaultCh, vaultCh, balanceCh
    in {
      lookup!(\`rho:rchain:revVault\`, *RevVaultCh) |
      for (@(_, RevVault) &lt;- RevVaultCh) {
        @RevVault!("findOrCreate", myGovRevAddr, *vaultCh) |
        for (@(true, vault) &lt;- vaultCh) {
          @vault!("balance", *balanceCh) |
          for (@balance &lt;- balanceCh) {
            return!(["#define", "$myBalance", balance])
          }
        }
      }
    }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">newinbox</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">lockerTag</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'inbox'</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// TODO: get contract URIs from rhopm / rho_modules</span>
      <span class="token literal-property property">InboxURI</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'rho:id:ohyqkr5jmritq8chnwijpufbx3tan6d1hffiksg9qiz9rmuy97a51t'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'uri'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    new deployId(\`rho:rchain:deployId\`), deployerId(\`rho:rchain:deployerId\`),
      lookup(\`rho:registry:lookup\`), insertArbitrary(\`rho:registry:insertArbitrary\`),
      inboxCh, capabilities, ret
    in {
      lookup!(InboxURI, *inboxCh) |
      for (Inbox &lt;- inboxCh) {
        Inbox!(*capabilities) |
        for (receive, send, peek &lt;- capabilities) {
          insertArbitrary!(*send, *ret)|
          for (@uri &lt;- ret) {
            @[*deployerId, lockerTag]!({"inbox": *send, "receive": *receive, "peek": *peek, "URI": uri}) |
            deployId!(["#define", "$" ++ lockerTag, uri])
          }
        }
      }
    }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sendMail</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">lockerTag</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'inbox'</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token literal-property property">toInboxURI</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'uri'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token keyword module keyword-from">from</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token literal-property property">sub</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'hello from ravi for hackathon 2020'</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">new deployId(\`rho:rchain:deployId\`), deployerId(\`rho:rchain:deployerId\`),

        lookup(\`rho:registry:lookup\`), inboxCh
        in {
            lookup!(toInboxURI, *inboxCh) |
            for (toinbox &lt;- inboxCh) {
                toinbox!({"from": from, "to": to, "sub": sub, "body": body}, *deployId)
            }
      }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">peekInbox</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">lockerTag</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'inbox'</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">new deployId(\`rho:rchain:deployId\`), deployerId(\`rho:rchain:deployerId\`), ch
      in {
        for(@{"peek": *peek, ..._} &lt;&lt;- @[*deployerId, lockerTag]) {
          peek!(*deployId)
        }
      }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">checkRegistration</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">myGovRevAddr</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'walletRevAddr'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      rollReg<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    new return,
      lookup(\`rho:registry:lookup\`),
      ch in
    {
      lookup!(rollReg, *ch) |
      for (@addrSet &lt;- ch) {
        return!(["#define", "$agm2020voter", addrSet.contains(myGovRevAddr)])
      }
    }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">newCommunity</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lockerTag</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'inbox'</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">CommunityReg</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'rho:id:ojkxxx95izqftspy5515fj58z58qrcc3ii9gktjcdo8d9hcqqnsuc9'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'uri'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    new out, deployId(\`rho:rchain:deployId\`), deployerId(\`rho:rchain:deployerId\`),
  lookup(\`rho:registry:lookup\`), ret, ret2
in {
  lookup!(CommunityReg, *ret)|
  for ( C &lt;- ret) {
        for(@{"inbox": *inbox, ..._} &lt;&lt;- @{[*deployerId, lockerTag]}) {
          C!("new", name, *inbox, *ret)|
          for (caps &lt;- ret) {
            if (*caps != Nil) {
              inbox!(["Community", name, *caps], *deployId)
            } else {
              deployId!("newCommunity " ++ name ++ " failed")
            }
          }
        }
  }
}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">addMember</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'?'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">themBoxReg</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'uri'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'?'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">community</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'?'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lockerTag</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'inbox'</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    new deployId(\`rho:rchain:deployId\`), deployerId(\`rho:rchain:deployerId\`), lookup(\`rho:registry:lookup\`),
    ret, boxCh, ack in {
      for(@{"peek": *peek, "inbox": *inbox, ..._} &lt;&lt;- @{[*deployerId, lockerTag]}) {
        lookup!(themBoxReg, *boxCh) |
        peek!("Community", community, *ret)|
        for ( @[{"admin": *admin, "read": *read, "write": *write, "grant": *grant}] &lt;- ret; themBox &lt;- boxCh ) {
          //stdout!("adding user")|
          admin!("add user", name, *inbox, *ret) |
          for (selfmod &lt;- ret) {
            //stdout!("user added") |
            themBox!(["member", community, {"read": *read, "selfmod": *selfmod}], *deployId)
          }
        }
      }
    }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">makeMint</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'myTokenMint'</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lockerTag</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'inbox'</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">MakeMintReg</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'uri'</span><span class="token punctuation">,</span>
        <span class="token comment">// genesis contract</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'rho:id:asysrwfgzf8bf7sxkiowp4b3tcsy4f8ombi3w96ysox4u3qdmn1wbc'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    new return, lookup(\`rho:registry:lookup\`),
  deployerId(\`rho:rchain:deployerId\`),
  deployId(\`rho:rchain:deployId\`),
  ch in {
  lookup!(MakeMintReg, *ch)
  |
  for (@(nonce, *MakeMint) &lt;- ch) {
    MakeMint!(*ch) |
    for (aMint &lt;- ch) {
      for (@{"inbox": *inbox, ..._} &lt;&lt;- @{[*deployerId, lockerTag]}) {
        // send the mint to my inbox for safe keeping.
        inbox!(["Mint", name, *aMint], *deployId)
      }
    }
  }
}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
      </div>
      
      
    
    
    
    
    
    
  
    </body></html>